<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.3.0/ol.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="styles.css">
    <title>WebGIS Catastro de Afectaciones por Marejadas</title>
</head>
<body>
    <div class="container">
      <nav class="navbar navbar-fixed-top navbar-default" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">WebGIS - Catastro de Marejadas</a>
          </div>
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
              <li class="active"><a href="#">Inicio</a></li>
              <li><a href="#">Acerca de</a></li>
              <li><a href="#">Contacto</a></li>
            </ul>
            <form class="navbar-form navbar-left" role="search" id="search-form">
              <div class="form-group">
                <input type="text" class="form-control" id="search-input" placeholder="Buscar ubicaci√≥n...">
              </div>
              <button type="submit" class="btn btn-default">
                <span class="hidden-xs">Buscar</span>
                <span class="visible-xs-inline">üîç</span>
              </button>
              <button type="button" class="btn btn-primary" id="current-location-btn" title="Mi ubicaci√≥n actual">
                <i class="fa fa-location-arrow"></i>
                <span class="hidden-xs">Mi ubicaci√≥n</span>
              </button>
            </form>
          </div>
        </div>
      </nav>
    </div>
    
    <div class="navbar-offset"></div>
    
    <!-- Contenedor de leyendas en la esquina superior derecha -->
    <div id="legend-container">
        <!-- Leyenda de Nivel de Da√±o (por defecto visible) -->
        <div id="legend" class="legend-box">
            <h5>Leyenda - Nivel de Da√±o Percibido</h5>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #2ecc71;"></div>
                <span>1 ‚Äî Leve</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #f39c12;"></div>
                <span>2 ‚Äî Moderado</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #e74c3c;"></div>
                <span>3 ‚Äî Severo</span>
            </div>
            
            <div class="legend-toggle-group">
                <button class="legend-toggle-btn active" data-target="damage">
                    Da√±o
                </button>
                <button class="legend-toggle-btn" data-target="location">
                    Lugar
                </button>
                <button class="legend-toggle-btn" data-target="wave">
                    Marejada
                </button>
            </div>
        </div>
        
        <!-- Leyenda de Tipo de Lugar (inicialmente oculta) -->
        <div id="location-legend" class="legend-box" style="display: none;">
            <h5>Leyenda - Tipo de Lugar</h5>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #3498db;"></div>
                <span>Vereda</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #9b59b6;"></div>
                <span>Calzada o calle</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #e67e22;"></div>
                <span>Interior de vivienda</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #1abc9c;"></div>
                <span>Interior de comercio</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #d35400;"></div>
                <span>Espacio p√∫blico costero</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #c0392b;"></div>
                <span>Infraestructura cr√≠tica</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #16a085;"></div>
                <span>Playa o roquer√≠os</span>
            </div>
            
            <div class="legend-toggle-group">
                <button class="legend-toggle-btn" data-target="damage">
                    Da√±o
                </button>
                <button class="legend-toggle-btn active" data-target="location">
                    Lugar
                </button>
                <button class="legend-toggle-btn" data-target="wave">
                    Marejada
                </button>
            </div>
        </div>
        
        <!-- Leyenda de Categor√≠as de Marejadas (inicialmente oculta) -->
        <div id="wave-legend" class="legend-box" style="display: none;">
            <h5>Leyenda - Categor√≠a de Marejada</h5>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #27ae60;"></div>
                <span>N ‚Äî Oleaje normal</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #f1c40f;"></div>
                <span>N+ ‚Äî Oleaje fuerte</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #e67e22;"></div>
                <span>M1 ‚Äî Categor√≠a 1</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #d35400;"></div>
                <span>M2 ‚Äî Categor√≠a 2</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #c0392b;"></div>
                <span>M3 ‚Äî Categor√≠a 3</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #8e44ad;"></div>
                <span>M4 ‚Äî Categor√≠a 4</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background-color: #2c3e50;"></div>
                <span>M5 ‚Äî Categor√≠a 5</span>
            </div>
            
            <div class="legend-toggle-group">
                <button class="legend-toggle-btn" data-target="damage">
                    Da√±o
                </button>
                <button class="legend-toggle-btn" data-target="location">
                    Lugar
                </button>
                <button class="legend-toggle-btn active" data-target="wave">
                    Marejada
                </button>
            </div>
        </div>
    </div>
    
    <div id="map"></div>
    
    <div class="row main-row">
        <div class="col-sm-4 col-md-3 sidebar sidebar-left pull-left">
            <div class="panel-group sidebar-body" id="accordion-left">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" href="#filters-panel">
                                <i class="fa fa-filter"></i>
                                Filtros
                            </a>
                            <span class="pull-right slide-submenu">
                                <i class="fa fa-chevron-left"></i>
                            </span>
                        </h4>
                    </div>
                    <div id="filters-panel" class="panel-collapse collapse in">
                        <div class="panel-body">
                            <form id="filter-form">
                                <div class="filter-group">
                                    <label for="filter-location">Tipo de Lugar:</label>
                                    <select id="filter-location">
                                        <option value="">Todos</option>
                                        <option value="vereda">Vereda</option>
                                        <option value="calzada_calle">Calzada o calle</option>
                                        <option value="interior_vivienda">Interior de vivienda</option>
                                        <option value="interior_comercio">Interior de comercio o servicio</option>
                                        <option value="espacio_publico">Espacio p√∫blico costero</option>
                                        <option value="infraestructura">Infraestructura cr√≠tica</option>
                                        <option value="playa">Playa o sector de roquer√≠os</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label for="filter-wave">Categor√≠a de Marejada:</label>
                                    <select id="filter-wave">
                                        <option value="">Todas</option>
                                        <option value="N">N ‚Äî Oleaje normal</option>
                                        <option value="N_plus">N+ ‚Äî Oleaje fuerte</option>
                                        <option value="M1">M1 ‚Äî Categor√≠a 1</option>
                                        <option value="M2">M2 ‚Äî Categor√≠a 2</option>
                                        <option value="M3">M3 ‚Äî Categor√≠a 3</option>
                                        <option value="M4">M4 ‚Äî Categor√≠a 4</option>
                                        <option value="M5">M5 ‚Äî Categor√≠a 5</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label for="filter-rain">Lluvia durante el evento:</label>
                                    <select id="filter-rain">
                                        <option value="">Todos</option>
                                        <option value="no_lluvia">No hab√≠a lluvia</option>
                                        <option value="lluvia_leve">Lluvia leve</option>
                                        <option value="lluvia_moderada">Lluvia moderada</option>
                                        <option value="lluvia_intensa">Lluvia intensa</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label for="filter-tide">Condici√≥n de marea:</label>
                                    <select id="filter-tide">
                                        <option value="">Todas</option>
                                        <option value="marea_baja">Marea baja</option>
                                        <option value="marea_media">Marea media</option>
                                        <option value="marea_alta">Marea alta</option>
                                        <option value="no_sabe">No sabe</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label for="filter-damage">Nivel de Da√±o:</label>
                                    <select id="filter-damage">
                                        <option value="">Todos</option>
                                        <option value="1">1 ‚Äî Leve</option>
                                        <option value="2">2 ‚Äî Moderado</option>
                                        <option value="3">3 ‚Äî Severo</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label for="filter-affectation">Afectaci√≥n Principal:</label>
                                    <select id="filter-affectation">
                                        <option value="">Todas</option>
                                        <option value="inundacion_vereda">Inundaci√≥n de vereda</option>
                                        <option value="inundacion_calle">Inundaci√≥n de calle o v√≠a</option>
                                        <option value="inundacion_vivienda">Inundaci√≥n de vivienda</option>
                                        <option value="inundacion_comercio">Inundaci√≥n de comercio o servicio</option>
                                        <option value="danio_infraestructura">Da√±o a infraestructura</option>
                                        <option value="erosion">Erosi√≥n o socavaci√≥n</option>
                                        <option value="arrastre">Arrastre de objetos o veh√≠culos</option>
                                        <option value="salpicaduras">Salpicaduras sin inundaci√≥n</option>
                                    </select>
                                </div>
                                
                                <button type="submit" class="btn btn-primary btn-block">Aplicar Filtros</button>
                                <button type="button" id="reset-filters" class="btn btn-default btn-block" style="margin-top: 5px;">
                                    Limpiar Filtros
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" href="#statistics-panel">
                                <i class="fa fa-bar-chart"></i>
                                Estad√≠sticas
                            </a>
                        </h4>
                    </div>
                    <div id="statistics-panel" class="panel-collapse collapse in">
                        <div class="panel-body">
                            <!-- Total siempre visible -->
                            <div class="stat-item total-stat">
                                <strong>Total de Reportes:</strong> <span id="total-reports" class="stat-value">0</span>
                            </div>
                            
                            <!-- Dropdown para Nivel de Da√±o -->
                            <div class="dropdown">
                                <button class="btn btn-default btn-sm btn-block dropdown-toggle" type="button" data-toggle="dropdown">
                                    Nivel de Da√±o <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu stat-dropdown-menu">
                                    <li class="dropdown-header">Nivel de Da√±o</li>
                                    <li>
                                        <span class="stat-label">Severo (3):</span>
                                        <span id="damage-severe" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Moderado (2):</span>
                                        <span id="damage-moderate" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Leve (1):</span>
                                        <span id="damage-mild" class="stat-value">0</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Dropdown para Categor√≠as de Marejada -->
                            <div class="dropdown">
                                <button class="btn btn-default btn-sm btn-block dropdown-toggle" type="button" data-toggle="dropdown">
                                    Categor√≠as de Marejada <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu stat-dropdown-menu">
                                    <li class="dropdown-header">Categor√≠as de Marejada</li>
                                    <li>
                                        <span class="stat-label">M5:</span>
                                        <span id="wave-m5" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">M4:</span>
                                        <span id="wave-m4" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">M3:</span>
                                        <span id="wave-m3" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">M2:</span>
                                        <span id="wave-m2" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">M1:</span>
                                        <span id="wave-m1" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">N+:</span>
                                        <span id="wave-n-plus" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">N:</span>
                                        <span id="wave-n" class="stat-value">0</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Dropdown para Tipos de Afectaci√≥n -->
                            <div class="dropdown">
                                <button class="btn btn-default btn-sm btn-block dropdown-toggle" type="button" data-toggle="dropdown">
                                    Tipos de Afectaci√≥n <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu stat-dropdown-menu">
                                    <li class="dropdown-header">Tipos de Afectaci√≥n</li>
                                    <li>
                                        <span class="stat-label">Inund. Calle:</span>
                                        <span id="affectation-street" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Inund. Vivienda:</span>
                                        <span id="affectation-house" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Inund. Vereda:</span>
                                        <span id="affectation-sidewalk" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Inund. Comercio:</span>
                                        <span id="affectation-commerce" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Da√±o Infra:</span>
                                        <span id="affectation-infra" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Erosi√≥n:</span>
                                        <span id="affectation-erosion" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Arrastre:</span>
                                        <span id="affectation-drag" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Salpicaduras:</span>
                                        <span id="affectation-splash" class="stat-value">0</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Dropdown para Tipo de Lugar -->
                            <div class="dropdown">
                                <button class="btn btn-default btn-sm btn-block dropdown-toggle" type="button" data-toggle="dropdown">
                                    Tipo de Lugar <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu stat-dropdown-menu">
                                    <li class="dropdown-header">Tipo de Lugar</li>
                                    <li>
                                        <span class="stat-label">Vereda:</span>
                                        <span id="tipo-vereda" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Calzada:</span>
                                        <span id="tipo-calzada" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Vivienda:</span>
                                        <span id="tipo-vivienda" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Comercio:</span>
                                        <span id="tipo-comercio" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Esp. P√∫blico:</span>
                                        <span id="tipo-espacio-publico" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Infraestructura:</span>
                                        <span id="tipo-infraestructura" class="stat-value">0</span>
                                    </li>
                                    <li>
                                        <span class="stat-label">Playa:</span>
                                        <span id="tipo-playa" class="stat-value">0</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <hr>
                            
                            <!-- Secci√≥n de Gr√°ficos -->
                            <div class="charts-section">
                                <h5>Visualizaciones</h5>
                                <div class="chart-selector">
                                    <select id="chart-type-selector" class="form-control input-sm">
                                        <option value="damage">Nivel de Da√±o</option>
                                        <option value="wave">Categor√≠a Marejada</option>
                                        <option value="location">Tipo de Lugar</option>
                                        <option value="affectation">Tipo de Afectaci√≥n</option>
                                    </select>
                                </div>
                                <div class="chart-container">
                                    <canvas id="main-chart"></canvas>
                                </div>
                                <div class="chart-legend" id="chart-legend"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" href="#kobo-panel">
                                <i class="fa fa-plus-circle"></i>
                                Realizar Reporte
                            </a>
                        </h4>
                    </div>
                    <div id="kobo-panel" class="panel-collapse collapse in">
                        <div class="panel-body">
                            <p>Para reportar una nueva afectaci√≥n por marejadas:</p>
                            <button id="open-kobo-form" class="btn-kobo">Abrir Formulario Kobo</button>
                            <p style="font-size: 12px; margin-top: 10px; color: #666;">
                                El formulario se abrir√° en una nueva ventana/tab.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bot√≥n para mostrar/ocultar sidebar -->
    <div class="sidebar-toggle-btn">
        <i class="fa fa-bars"></i>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ol@7.3.0/dist/ol.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="app.js"></script>
</body>
</html>